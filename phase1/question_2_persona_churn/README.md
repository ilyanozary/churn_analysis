# فاز ۱ — سوال ۲: کدام پرسوناها بیشترین/کمترین ریزش را دارند و چرا؟

## هدف
- محاسبه و رتبه‌بندی «نرخ ریزش» برای هر پرسونا و توضیح تفاوت‌ها با شاخص‌های سادهٔ رفتاری (نرخ پاسخ/سؤال/کامنت به‌ازای ماه فعال) و اعتبار (reputation).

## تعریف‌ها و داده‌ها
- تعریف ریزش (churn):
  - inactive_gap = total_duration − active_duration
  - برچسب ریزش: y_churn = 1 اگر inactive_gap ≥ 12 ماه (آستانهٔ فعلی: ۱۲ ماه)
- پرسونا: از ستون `cluster_nmf_20` در فایل NMF.
- ورودی‌ها:
  - `nmf_clusters_continent_pronouns_age_20.csv` (پرسونا + فعالیت‌ها)
  - `2024_expertise_shape_final.csv` `expertise_shape`

## روش اجرا
1. پاک‌سازی شناسه‌ها و تبدیل durationها به عدد، محاسبهٔ `inactive_gap` و `y_churn`.
2. مهندسی ویژگی‌های توضیح‌دهندهٔ ساده در سطح کاربر:
   - `answers_rate_pm`, `questions_rate_pm`, `comments_rate_pm` = تعداد رویداد / ماه فعال
3. تجمیع در سطح پرسونا (`cluster_nmf_20`) و محاسبهٔ شاخص‌ها:
   - `users`, `churners`, `churn_rate`, `avg_inactive_gap`, نرخ‌های per-month، و میانگین `reputation` (در صورت وجود)
4. محاسبهٔ همبستگی `churn_rate` با شاخص‌های توضیح‌دهنده در سطح پرسونا.
5. ترسیم نمودار میله‌ای «نرخ ریزش به‌ازای پرسونا».

## نتایج (اجرا: 2025-08-19)
- نرخ ریزش کل: حدود 37.5%
- پرریسک‌ترین پرسوناها (نرخ ریزش بالاتر):
  - کلاستر 18 ≈ 57.9%
  - کلاستر 9 ≈ 57.2%
  - کلاستر 19 ≈ 57.1%
- کم‌ریسک‌ترین پرسوناها (نرخ ریزش پایین‌تر):
  - کلاستر 14 ≈ 18.7%
  - کلاستر 17 ≈ 20.1%
  - کلاستر 8 ≈ 23.5%
- همبستگی‌ها با `churn_rate` (سطح پرسونا):
  - `avg_inactive_gap`: +0.994 (مثبت و بسیار قوی)
  - `questions_rate_pm`: −0.862
  - `comments_rate_pm`: −0.830
  - `answers_rate_pm`: −0.827
  - `reputation`: −0.786
- برداشت: پرسوناهای پُرریسک فاصلهٔ غیرفعالِ بلندتر و نرخ‌های فعالیت پایین‌تری دارند؛ پرسوناهای کم‌ریسک دقیقاً برعکس.

## خروجی‌ها
- جدول چکیدهٔ پرسوناها (CSV):
  - `phase1/question_2_persona_churn/outputs/phase1_q2_persona_churn_summary.csv`
- همبستگی‌ها (CSV):
  - `phase1/question_2_persona_churn/outputs/phase1_q2_persona_churn_correlations.csv`
- نمودار: در نوت‌بوک ترسیم می‌شود (Churn rate by persona).


## چرایی انتخاب فایل NMF
- فایل `nmf_clusters_continent_pronouns_age_20.csv` هم ستون پرسونا (`cluster_nmf_20`) را دارد و هم شمارش‌های فعالیت و durationها را؛ بنابراین بهترین منبع برای محاسبهٔ ریزش و نرخ‌های per-month است. فایل خبرگی برای تکمیل تحلیل استفاده می‌شود، اما برای محاسبهٔ ریزش ضروری نیست.

## بازتولیدپذیری
- بذر تصادفی: 42
- آستانهٔ ریزش: 12 ماه (قابل تنظیم)
- نسخه‌های کتابخانه‌ها مطابق محیط نوت‌بوک (لیست‌شده در کرنل)
- تاریخ اجرا: 2025-08-19

